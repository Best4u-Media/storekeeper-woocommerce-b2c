name: Deploy to WordPress.org
on:
  release:
    types: [released]
jobs:
  tag:
    name: Send to wordpress
    runs-on: ubuntu-latest
    steps:
      - name: Download artifact
        uses: dawidd6/action-download-artifact@v2
        with:
          github_token: ${{secrets.GITHUB_TOKEN}}
          workflow: build-zip.yml
          workflow_conclusion: success
          name: storekeeper-woocommerce-b2c

      - name: Prepare directory
        run: |
          unzip storekeeper-woocommerce-b2c.zip
          rm storekeeper-woocommerce-b2c.zip
          mv storekeeper-woocommerce-b2c/* .
          mv storekeeper-woocommerce-b2c/.[a-z]* .
          rmdir storekeeper-woocommerce-b2c

      - name: WordPress Plugin Deploy
        id: deploy
        uses: 10up/action-wordpress-plugin-deploy@stable
        if: ${{ startsWith( github.ref, 'refs/tags/' ) }}
        with:
          generate-zip: true
        env:
          SVN_USERNAME: ${{ secrets.SVN_USERNAME }}
          SVN_PASSWORD: ${{ secrets.SVN_PASSWORD }}

